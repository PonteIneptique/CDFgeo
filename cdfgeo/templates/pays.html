{% extends "conteneur.html" %}

{% block js %}
<script type="text/javascript">
    $(document).ready(function() {
        // Création de la carte à l'id "map"
        var map = L.map('map');
        // Centrer la vue sur 51.505;-0.09 avec un zoom de 10
        map.setView([{{  pays.pays_lat}}, {{ pays.pays_long}}], 10);
        // Usage des tuiles de carte d'OpenStreetMap puis ajout à la carte map
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        $.ajax("{{ url_for("api_pays", pays_id=pays.pays_id) }}").done(function(data, x, z) {
            // On réserve des variables qui permettront de calculer le centre de la carte à la fin
            var max_lat = null,
                min_lat = null,
                max_long = null,
                min_long = null;
            // On boucle sur les clefs
            for(var mission_ in data.missions) {
                // On crée un raccourci vers le dictionnaire de lieu et vers ses longitudes et latitudes
                var long_lat = mission.latlong;

                // Creation du marqueur
                var marker = L.marker([long_lat[1], long_lat[0]]);
                // Ajout à la carte
                marker.addTo(map);
                // Création d'un popup
                marker.bindPopup("<h2>"+mission.intitule+"</h2><p>"+mission.lieu+"</p><p>"+lieu.description+"</p>");
            }
            // Création des valeurs de latitudes et longitudes minimales et maximales
            var min_point = L.latLng([min_lat, min_long]),
                max_point = L.latLng([max_lat, max_long]),
                // Création d'une frontiere
                // http://leafletjs.com/reference-1.3.0.html#latlngbounds
                frontieres = L.latLngBounds(min_point, max_point);
            // Centrage sur les frontieres
            map.fitBounds(frontieres);
        });
    });
 </script>
{% endblock %}
{%  block corps %}
    <h1>{{ pays.pays_intitule }}</h1>
{% endblock %}